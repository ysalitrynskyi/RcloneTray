<!doctype html>
<html>

  <head>

    <script>
      $main.loadStyles()

      // Initialize the page once DOM is ready
      document.addEventListener('DOMContentLoaded', async function () {
        // Fetch props asynchronously
        const props = await $main.getProps()

        // Update title and static fields
        document.title = `Edit ${props.$name}`
        document.getElementById('bookmark-type').textContent = props.type
        document.getElementById('bookmark-name').textContent = props.$name

        // Render bookmark settings
        window.api.renderBookmarkSettings(
          document.getElementById('bookmark-settings'),
          props.type,
          {
            options: props,
          }
        )

        // Handle form submission
        document.getElementById('the-form')
          .addEventListener('submit', async function (event) {
            event.preventDefault()
            let data = window.electronAPI.getTheFormData(this)
            try {
              await $main.rclone.updateBookmark(props.$name, data.options)
              window.close()
            } catch (error) {
              window.electronAPI.errorBox(error.message || error)
            }
          })

        // Handle delete button
        document.getElementById('delete-bookmark-button')
          .addEventListener('click', async function (event) {
            event.preventDefault()
            const confirmed = await window.electronAPI.confirm('Are you sure you want to delete the bookmark?')
            if (confirmed) {
              try {
                await $main.rclone.delBookmark(props.$name)
                window.close()
              } catch (error) {
                window.electronAPI.errorBox(error.message || error)
              }
            }
          })
      })
    </script>

  </head>

  <body>

    <form id="the-form">

      <div class="row">
        <div class="cell-left">
          Type
        </div>
        <div class="cell-right">
          <var id="bookmark-type"></var>
        </div>
      </div>

      <div class="row">
        <div class="cell-left">
          Name
        </div>
        <div class="cell-right">
          <var id="bookmark-name"></var>
        </div>
      </div>

      <div id="bookmark-settings"></div>

      <div class="row right buttons">

        <button id="delete-bookmark-button">
          Delete
        </button>

        <button type="submit">
          Save
        </button>
      </div>

    </form>

  </body>

</html>
